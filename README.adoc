= UnitsDB

== Purpose

This data repository is used in conjunction with UnitsML.

Sources include:

* https://www.bipm.org/en/publications/si-brochure/[BIPM SI Brochure]
* https://www.nist.gov/pml/special-publication-811[NIST SP 811]
* ISO 80000 series
* (in some cases, "Encyclopaedia of Scientific Units, Weights and Measures, Their SI Equivalences and Origins" by François Cardarelli, is consulted)

NOTE: Conversion factors here are not updated with the revised SI.

== Structure

This repository contains the following YAML files:

`dimensions.yaml`:: Contains the base dimensions and their symbols.

`prefixes.yaml`:: Contains the SI prefixes and their symbols.

`units.yaml`:: Contains the units and their symbols.

`unit_systems.yaml`:: Contains the unit systems and their symbols.

`quantities.yaml`:: Contains the quantities and their symbols.


== Dimensions

=== General

A dimension object in `dimensions.yaml` typically has the following structure:

[source,yaml]
----
dimension_id:
  {dimension_name}:
    power_numerator: power_numerator
    symbol: ASCII representation
    symbols:
    - id: dimension_symbol_id
      ascii: ASCII representation
      html: "HTML representation"
      mathml: "MathML representation"
      latex: "LaTeX representation"
      unicode: "Unicode representation"
----

For example:

[source,yaml]
----
NISTd1:
  length:
    power_numerator: 1
    symbol: L
    symbols:
    - id: dim_L
      ascii: L
      html: "&#x1D5AB;"
      mathml: "<mi mathvariant='sans-serif'>L</mi>"
      latex: "\\ensuremath{\\mathsf{L}}"
      unicode: "\U0001D5AB"
NISTd2:
  mass:
    power_numerator: 1
    symbol: M
    symbols:
    - id: dim_M
      ascii: M
      html: "&#x1D5AC;"
      mathml: "<mi mathvariant='sans-serif'>M</mi>"
      latex: "\\ensuremath{\\mathsf{M}}"
      unicode: "\U0001D5AC"
----

=== Notes

The following dimensions are identified by NIST but they are excluded from
`dimensions.yaml` since they are unused:

[source,yaml]
----
NISTd87:
  dimensionless: true

NISTd86:
  dimensionless: true

NISTd81:
  dimensionless: true

NISTd82:
  dimensionless: true

NISTd83:
  dimensionless: true

NISTd89:
  dimensionless: true

NISTd88:
  dimensionless: true

NISTd91:
  dimensionless: true

NISTd90:
  dimensionless: true

NISTd92:
  dimensionless: true

NISTd93:
  dimensionless: true
----


== Prefixes

=== General

A prefix object in `prefixes.yaml` typically has the following structure:

[source,yaml]
----
prefix_id:
  name: prefix_name
  symbol:
    ascii: ASCII representation
    html: "HTML representation"
    latex: "LaTeX representation"
    unicode: "Unicode representation"
  base: base
  power: power
----

For example:

[source,yaml]
----
NISTp10_2:
  name: hecto
  symbol:
    ascii: h
    html: h
    latex: h
    unicode: h
  base: 10
  power: 2
NISTp10_1:
  name: deka
  symbol:
    ascii: da
    html: da
    latex: da
    unicode: da
  base: 10
  power: 1
----

=== Notes

Decimal prefixes are keyed by their power of 10, e.g. `NISTp10_1`

The prefix `NISTp10_0` is a placeholder for unity.

Binary prefixes are keyed by their power of 2, e.g. `NISTp2_10`


== Quantities

=== General

A quantity object in `quantities.yaml` typically has the following structure:

[source,yaml]
----
quantity_id:
  dimension_url: "#dimension_id"
  quantity_type: {base|derived}
  quantity_name:
  - quantity_name
  unit_reference:
  - name: unit_name
    url: "#unit_id"
----


For example:

[source,yaml]
----
NISTq8:
  dimension_url: "#NISTd8"
  quantity_type: base
  quantity_name:
  - area
  unit_reference:
  - name: square yard
    url: "#NISTu164"
  - name: square mile
    url: "#NISTu165"
  - name: square meter
    url: "#NISTu1e2/1"
  - name: circular mil
    url: "#NISTu283"
  - name: acre (based on US survey foot)
    url: "#NISTu317"
  - name: are
    url: "#NISTu42"
  - name: barn
    url: "#NISTu43"
  - name: hectare
    url: "#NISTu44"
  - name: square foot
    url: "#NISTu45"
  - name: square inch
    url: "#NISTu46"
NISTq166:
  dimension_url: "#NISTd18"
  quantity_type: derived
  quantity_name:
  - electric potential
  unit_reference:
  - name: atomic unit of electric potential
    url: "#NISTu261"
  - name: statvolt
    url: "#NISTu268"
NISTq7:
  dimension_url: "#NISTd7"
  quantity_type: base
  quantity_name:
  - luminous intensity
  unit_reference:
  - name: candela
    url: "#NISTu7"
----


== Units

=== General

A unit object in `units.yaml` typically has the following structure:

[source,yaml]
----
unit_id:
  dimension_url: "#dimension_id"
  short: unit_short_name
  root: true
  unit_system:
    type: unit_system_type
    name: unit_system_name
  unit_name:
  - unit_name
  symbols:
  - id: symbol_id
    ascii: ASCII representation
    html: "HTML representation"
    mathml: "MathML representation"
    latex: "LaTeX representation"
    unicode: "Unicode representation"
  root_units:
  - unit: unit_name
    power_numerator: power_numerator
  quantity_reference:
  - name: quantity_name
    url: "#quantity_id"
----

For example:

[source,yaml]
----
NISTu5:
  dimension_url: "#NISTd5"
  short: kelvin
  root: true
  unit_system:
    type: SI_base
    name: SI
  unit_name:
  - kelvin
  symbols:
  - id: K
    ascii: K
    html: K
    mathml: "<mi mathvariant='normal'>K</mi>"
    latex: "\\ensuremath{\\mathrm{K}}"
    unicode: K
  - id: degK
    ascii: degK
    html: "&#176;K"
    mathml: "<mi mathvariant='normal'>&#176;K</mi>"
    latex: "\\ensuremath{\\mathrm{^{\\circ}K}}"
    unicode: "°K"
  root_units:
  - unit: kelvin
    power_numerator: 1
  quantity_reference:
  - name: thermodynamic temperature
    url: "#NISTq5"
----


== Unit systems

=== General

A unit system object in `unit_systems.yaml` typically has the following structure:

[source,yaml]
----
- id: unit_system_id
  name: unit_system_name
  acceptable: {true|false} # whether the unit system is SI acceptable
----

For example:

[source,yaml]
----
- id: SI_base
  name: SI
  acceptable: true
- id: SI_derived_special
  name: SI
  acceptable: true
----


== Contributing

=== General

When contributing to this repository, please follow these guidelines.

=== Command-line Utilities

UnitsDB provides several command-line utilities to help maintain and validate the database files. These utilities are available through the `unitsdb-utils` script in the `scripts` directory.

==== Setup

To use the command-line utilities:

[source,bash]
----
# Navigate to the scripts directory
cd scripts

# Install dependencies
bundle install
----

==== Available Commands

===== normalize

Normalizes YAML files for consistent formatting and structure.

*Purpose*: Ensures all YAML files follow consistent formatting rules, including proper indentation, key ordering, and structure. This helps maintain consistency across the database and makes diffs more meaningful in version control.

*Usage*:

[source,bash]
----
# Normalize a specific file
BUNDLE_GEMFILE=scripts/Gemfile bundle exec ./scripts/unitsdb-utils normalize input.yaml output.yaml

# Normalize all YAML files in place
BUNDLE_GEMFILE=scripts/Gemfile bundle exec ./scripts/unitsdb-utils normalize --all --dir ..

# Normalize without sorting keys
BUNDLE_GEMFILE=scripts/Gemfile bundle exec ./scripts/unitsdb-utils normalize --no-sort input.yaml output.yaml
----

*Options*:

* `--all`, `-a` - Process all YAML files in the repository
* `--dir`, `-d` - Directory containing the YAML files (default: ".")
* `--[no-]sort` - Sort keys alphabetically (default: true)

===== check_uniqueness

Checks for uniqueness of 'short' and 'id' fields in YAML files.

*Purpose*: Ensures that identifier fields are unique across the database, preventing conflicting definitions.

*Usage*:

[source,bash]
----
# Check a specific file
BUNDLE_GEMFILE=scripts/Gemfile bundle exec ./scripts/unitsdb-utils check_uniqueness dimensions.yaml

# Check all YAML files
BUNDLE_GEMFILE=scripts/Gemfile bundle exec ./scripts/unitsdb-utils check_uniqueness --all --dir ..
----

*Options*:

* `--all`, `-a` - Check all YAML files in the repository
* `--dir`, `-d` - Directory containing the YAML files (default: ".")

===== validate references

Validates that all references between files exist and are correct.

*Purpose*: Ensures data integrity by confirming that any reference from one file to another (e.g., from a quantity to a dimension) points to an existing entity. This prevents broken links in the data model.

*Method of Operation*: The command builds a comprehensive registry of all identifiers across all files, then checks each reference against this registry. It supports both composite keys (`{type}:{id}`) and simple ID lookups, with special handling for unit system references.

*Usage*:

[source,bash]
----
# Validate references in a specific file
BUNDLE_GEMFILE=scripts/Gemfile bundle exec ./scripts/unitsdb-utils validate references check dimensions.yaml

# Validate references in all files
BUNDLE_GEMFILE=scripts/Gemfile bundle exec ./scripts/unitsdb-utils validate references check --all

# Show valid references along with invalid ones
BUNDLE_GEMFILE=scripts/Gemfile bundle exec ./scripts/unitsdb-utils validate references check --all --print_valid

# Debug the reference registry
BUNDLE_GEMFILE=scripts/Gemfile bundle exec ./scripts/unitsdb-utils validate references check --all --debug_registry
----

*Options*:

* `--all` - Check all YAML files in the repository
* `--print_valid` - Print valid references in addition to invalid ones
* `--debug_registry` - Show the registry contents for debugging

===== validate uniqueness

Validate the uniqueness of 'short' and 'id' fields (alternative to check_uniqueness).

*Purpose*: Similar to check_uniqueness but integrated into the validate subcommand system.

*Usage*:

[source,bash]
----
# Validate uniqueness in a specific file
BUNDLE_GEMFILE=scripts/Gemfile bundle exec ./scripts/unitsdb-utils validate uniqueness check dimensions.yaml

# Validate uniqueness in all files
BUNDLE_GEMFILE=scripts/Gemfile bundle exec ./scripts/unitsdb-utils validate uniqueness check --all
----

*Options*:

* `--all` - Check all YAML files in the repository

=== UnitsML validation

All YAML files must be validated against the UnitsML schema before submitting a
pull request.

To validate UnitsDB content using UnitsML Ruby:

[source,bash]
----
# Navigate to the scripts directory
cd scripts

# Install dependencies
bundle install

# Validate content using RSpec which uses UnitsML Ruby
BUNDLE_GEMFILE=scripts/Gemfile bundle exec rspec ../spec --format documentation
----


== Copyright and license

Copyright CalConnect. Incorporates public domain work from NIST.

This work is licensed under the Creative Commons Attribution 4.0 International
License. To view a copy of this license, visit
https://creativecommons.org/licenses/by/4.0/[CC-BY 4.0]
